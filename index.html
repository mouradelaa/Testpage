<script>
  const noBtn = document.getElementById("no");
  const yesBtn = document.getElementById("yes");
  const finalScreen = document.getElementById("final");

  let speed = 1;
  let scale = 1;
  let speaking = false;

  const darijaTaunts = [
    "Wa jawbi khlasss",
    "Ash had laaa?",
    "La la la, ma tdirhach",
    "Sir sir, hadi s3iba 3lik",
    "Bayna mkelkha"
  ];

  function speakDarija(text) {
    if (speaking) return;

    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "en-US";          // sounds MUCH better
    utter.rate = 0.9;              // slower, clearer
    utter.pitch = 0.8;             // less robotic
    utter.volume = 1;

    utter.onstart = () => speaking = true;
    utter.onend = () => speaking = false;

    speechSynthesis.cancel();
    speechSynthesis.speak(utter);
  }

  function moveNo() {
    const safeWidth = window.innerWidth * 0.6;
    const safeHeight = window.innerHeight * 0.5;

    const centerX = window.innerWidth / 2;
    const centerY = window.innerHeight / 2;

    const x =
      centerX - safeWidth / 2 +
      Math.random() * (safeWidth - noBtn.offsetWidth);

    const y =
      centerY - safeHeight / 2 +
      Math.random() * (safeHeight - noBtn.offsetHeight);

    noBtn.style.left = Math.max(60, x) + "px";
    noBtn.style.top = Math.max(80, y) + "px";
  }

  function panic() {
    speed += 0.4;
    scale = Math.max(0.4, scale - 0.06);
    noBtn.style.transform = `scale(${scale})`;

    const taunt =
      darijaTaunts[Math.floor(Math.random() * darijaTaunts.length)];
    speakDarija(taunt);

    if (navigator.vibrate) navigator.vibrate(80);

    for (let i = 0; i < speed; i++) {
      setTimeout(moveNo, i * 25);
    }
  }

  noBtn.addEventListener("mouseenter", panic);
  noBtn.addEventListener("touchstart", panic);

  moveNo();

  // Every 10 seconds background taunt
  setInterval(() => {
    const text = "Wa jawbi khlasss";

    const t = document.createElement("div");
    t.className = "taunt";
    t.innerText = text;
    document.body.appendChild(t);
    setTimeout(() => t.remove(), 2000);

    speakDarija(text);
  }, 10000);

  function emojiRain() {
    const e = document.createElement("div");
    e.className = "emoji";
    e.innerText = Math.random() > 0.5 ? "ðŸ˜‚" : "ðŸ¤£";
    e.style.left = Math.random() * 100 + "vw";
    e.style.animationDuration = 2 + Math.random() * 2 + "s";
    document.body.appendChild(e);
    setTimeout(() => e.remove(), 4000);
  }

  yesBtn.onclick = () => {
    finalScreen.style.display = "flex";
    speakDarija("Hahahaha, nti mkelkha!");
    setInterval(emojiRain, 120);
  };
</script>
